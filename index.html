<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script src="https://cdn.jsdelivr.net/gh/netizenorg/netnet-standard-library/build/nn.min.js"></script>
<script>
  
  function parseCSV (csvText) {
    const lines = csvText.trim().split('\n')
    const headers = lines.shift().split(',')
    return lines.map(line => {
      const values = line.split(',')
      return headers.reduce((object, header, index) => {
        object[header] = values[index]
        return object
      }, {})
    })
  }
  
  async function main () {
    const gpsRes = await fetch('countries-gps.csv')
    const gpsData = await gpsRes.text()
    const countries = parseCSV(gpsData)
    console.log(countries)
    
    const netRes = await fetch('internet-usage.csv')
    const netData = await netRes.text()
    const nets = parseCSV(netData)
    console.log(nets)
    
    const body = nn.get('body')
    const map = L.map(body).setView([51.505, -0.09], 3)
    L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map)
    
    countries.forEach(c => {
      L.marker([c.latitude, c.longitude]).addTo(map)
        .bindPopup(c.name)
        .openPopup()
    })
  }
 
  nn.on('load', main)
  
</script>